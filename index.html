<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Badminton - Parcours de formation</title>
    <link rel="manifest" href="./manifest.json">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 1rem;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 20px 25px rgba(0,0,0,0.1);
        }
        .header {
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        .content { padding: 2rem; }
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            margin: 0.5rem;
            font-size: 1rem;
        }
        .btn:hover { background: #1d4ed8; transform: translateY(-2px); }
        .btn-secondary { background: #6b7280; }
        .btn-secondary:hover { background: #4b5563; }
        .btn-success { background: #10b981; }
        .btn-danger { background: #ef4444; }
        .level-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            margin: 1rem;
            transition: all 0.3s;
        }
        .level-card:hover { border-color: #2563eb; transform: translateY(-4px); }
        .chapter-card {
            background: #f9fafb;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin: 1rem 0;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .chapter-card:hover { border-color: #2563eb; }
        .student-card {
            background: #f9fafb;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 0.5rem 0;
        }
        .counter-btn {
            padding: 0.5rem 1rem;
            font-size: 1.2rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: bold;
        }
        .counter-btn.success { background: #10b981; color: white; }
        .counter-btn.danger { background: #ef4444; color: white; }
        .timer-display {
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
            margin: 2rem 0;
            color: #2563eb;
        }
        .progress-bar {
            width: 100%;
            height: 1rem;
            background: #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            margin: 1rem 0;
        }
        .progress-fill {
            height: 100%;
            background: #2563eb;
            transition: width 0.3s;
        }
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .badge-excellent { background: #10b981; color: white; }
        .badge-tres-bien { background: #3b82f6; color: white; }
        .badge-bien { background: #f59e0b; color: white; }
        .passage-header {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .consignes-box {
            background: #eff6ff;
            padding: 1.5rem;
            border-radius: 0.75rem;
            border-left: 4px solid #2563eb;
            margin: 1rem 0;
        }
        .articulation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        .articulation-card {
            background: #dbeafe;
            padding: 1.5rem;
            border-radius: 0.75rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¸ Badminton - Parcours de formation</h1>
            <div id="header-buttons"></div>
        </div>
        <div class="content" id="main-content"></div>
    </div>
    <script>
        const state = {
            view: 'home',
            level: null,
            chapter: null,
            situation: null,
            passage: 0,
            students: [],
            results: {},
            warmupStep: 0,
            timer: null,
            timerSec: 0
        };

        const chapters = [
            { id: 0, title: "Contact volant-raquette", level: "1-2", situations: [
                { id: 0, title: "Jonglage" }
            ]},
            { id: 1, title: "Le dÃ©placement", level: "2-5", situations: [
                { id: 0, title: "DÃ©placement en Ã©toile" }
            ]},
            { id: 3, title: "Le revers", level: "3-5", situations: [
                { id: 0, title: "Apprentissage du revers", passages: [
                    { title: "Zone avant", emoji: "1ï¸âƒ£", objectif: "10 revers zone avant", critere: "Passe le filet", organisation: "Frappeur / Lanceur / Observateur" },
                    { title: "Zone centrale", emoji: "2ï¸âƒ£", objectif: "10 revers zone centrale", critere: "Trajectoire tendue", organisation: "Rotation des rÃ´les" },
                    { title: "Fond de court", emoji: "3ï¸âƒ£", objectif: "10 dÃ©gagements revers", critere: "Zone arriÃ¨re", organisation: "Rotation des rÃ´les" }
                ]}
            ]},
            { id: 7, title: "Services", level: "2-3", situations: [
                { id: 0, title: "Apprentissage des services", passages: [
                    { title: "Service rÃ©glementaire", emoji: "1ï¸âƒ£", objectif: "10 services rÃ©glementaires", critere: "Passe filet, zone service", organisation: "Serveur / Relanceur / Observateur" },
                    { title: "Service court", emoji: "2ï¸âƒ£", objectif: "10 services courts", critere: "Zone avant", organisation: "Rotation des rÃ´les" },
                    { title: "Service long", emoji: "3ï¸âƒ£", objectif: "10 services longs", critere: "Ligne de fond", organisation: "Ã‰valuation finale" }
                ]}
            ]},
            { id: 8, title: "Amortis", level: "2-3", situations: [
                { id: 0, title: "Apprentissage de l'amorti", passages: [
                    { title: "Zone centrale â†’ avant", emoji: "1ï¸âƒ£", objectif: "10 amortis", critere: "Sous sur-filet, zone avant", organisation: "Frappeur / Lanceur / Observateur" },
                    { title: "Contre-amorti CD", emoji: "2ï¸âƒ£", objectif: "10 contre-amortis", critere: "Zone dangereuse + replacement", organisation: "Rotation des rÃ´les" },
                    { title: "Contre-amorti revers", emoji: "3ï¸âƒ£", objectif: "10 contre-amortis revers", critere: "Zone dangereuse + replacement", organisation: "Ã‰valuation finale" }
                ]}
            ]},
            { id: 9, title: "DÃ©gagements", level: "2-3", situations: [
                { id: 0, title: "Apprentissage du dÃ©gagement", passages: [
                    { title: "Zone centrale â†’ arriÃ¨re", emoji: "1ï¸âƒ£", objectif: "10 dÃ©gagements", critere: "Au-dessus filet, zone arriÃ¨re", organisation: "Frappeur / Lanceur / Observateur" },
                    { title: "Zone arriÃ¨re â†’ arriÃ¨re", emoji: "2ï¸âƒ£", objectif: "10 dÃ©gagements fond â†’ fond", critere: "Ã‰changes zone arriÃ¨re", organisation: "Rotation des rÃ´les" },
                    { title: "Zone arriÃ¨re + replacement", emoji: "3ï¸âƒ£", objectif: "10 dÃ©gagements + replacement", critere: "Retour rapide au centre", organisation: "Ã‰valuation finale" }
                ]}
            ]}
        ];

        function render() {
            const hdr = document.getElementById('header-buttons');
            const main = document.getElementById('main-content');
            
            if (state.view === 'home') {
                hdr.innerHTML = '';
                main.innerHTML = '<div style="text-align:center;padding:3rem;"><h2>Bienvenue</h2>' +
                    '<button class="btn" onclick="state.view=\'levels\';render()">ğŸ¯ Commencer</button>' +
                    '<button class="btn" onclick="state.view=\'warmup-levels\';render()">ğŸ”¥ Ã‰chauffement</button>' +
                    '<button class="btn btn-secondary" onclick="state.view=\'students\';render()">ğŸ‘¥ Ã‰lÃ¨ves</button>' +
                    '<button class="btn btn-secondary" onclick="state.view=\'stats\';render()">ğŸ“Š Stats</button></div>';
            } 
            else if (state.view === 'levels' || state.view === 'warmup-levels') {
                hdr.innerHTML = '<button class="btn btn-secondary" onclick="state.view=\'home\';render()">ğŸ  Accueil</button>';
                main.innerHTML = '<h2>SÃ©lectionnez le niveau</h2><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;">' +
                    '<div class="level-card" onclick="selectLevel(2)"><div style="font-size:3rem">ğŸ¸</div><h3>Niveaux 1-2</h3><p>DÃ©butants</p></div>' +
                    '<div class="level-card" onclick="selectLevel(3)"><div style="font-size:3rem">ğŸ¯</div><h3>Niveau 3</h3><p>IntermÃ©diaires</p></div>' +
                    '<div class="level-card" onclick="selectLevel(4)"><div style="font-size:3rem">ğŸ†</div><h3>Niveaux 4-5</h3><p>AvancÃ©s</p></div></div>';
            }
            else if (state.view === 'chapters') {
                hdr.innerHTML = '<button class="btn btn-secondary" onclick="state.view=\'levels\';render()">â† Retour</button>';
                const filtered = chapters.filter(ch => {
                    const lvls = ch.level.split('-').map(l => parseInt(l));
                    if (state.level === 2) return lvls.includes(1) || lvls.includes(2);
                    if (state.level === 3) return lvls.includes(3);
                    if (state.level === 4) return lvls.includes(4) || lvls.includes(5);
                });
                let html = '<h2>Chapitres - Niveau ' + state.level + '</h2>';
                filtered.forEach(ch => {
                    html += '<div class="chapter-card" onclick="state.chapter=' + ch.id + ';state.view=\'situations\';render()"><h3>' + ch.title + '</h3></div>';
                });
                main.innerHTML = html;
            }
            else if (state.view === 'situations') {
                hdr.innerHTML = '<button class="btn btn-secondary" onclick="state.view=\'chapters\';render()">â† Retour</button>';
                const ch = chapters.find(c => c.id === state.chapter);
                let html = '<h2>' + ch.title + '</h2>';
                ch.situations.forEach(s => {
                    html += '<div class="chapter-card" onclick="state.situation=' + s.id + ';state.passage=0;state.view=\'detail\';render()"><h3>' + s.title + '</h3></div>';
                });
                main.innerHTML = html;
            }
            else if (state.view === 'detail') {
                renderDetail();
            }
            else if (state.view === 'students') {
                renderStudents();
            }
            else if (state.view === 'stats') {
                renderStats();
            }
            else if (state.view === 'warmup') {
                renderWarmup();
            }
        }

        function selectLevel(lvl) {
            state.level = lvl;
            if (state.view === 'warmup-levels') {
                state.view = 'warmup';
                state.warmupStep = 0;
            } else {
                state.view = 'chapters';
            }
            render();
        }

        function renderDetail() {
            const ch = chapters.find(c => c.id === state.chapter);
            const sit = ch.situations[state.situation];
            
            if (!sit.passages) {
                document.getElementById('header-buttons').innerHTML = '<button class="btn btn-secondary" onclick="state.view=\'situations\';render()">â† Retour</button>';
                document.getElementById('main-content').innerHTML = '<h2>' + sit.title + '</h2>' + renderStudentsList();
                return;
            }

            const pass = sit.passages[state.passage];
            const prog = (state.passage / sit.passages.length) * 100;
            
            let html = '<div class="passage-header"><div>Passage ' + (state.passage + 1) + ' / ' + sit.passages.length + '</div>' +
                '<div class="progress-bar"><div class="progress-fill" style="width:' + prog + '%"></div></div>' +
                '<div style="font-size:3rem">' + pass.emoji + '</div><h2>' + pass.title + '</h2></div>';
            
            html += '<div class="consignes-box"><h3>ğŸ“‹ Consignes</h3><p><strong>ğŸ¯ Objectif:</strong> ' + pass.objectif + '</p>' +
                '<p><strong>âœ… CritÃ¨re:</strong> ' + pass.critere + '</p>' +
                '<p><strong>ğŸ‘¤ Organisation:</strong> ' + pass.organisation + '</p></div>';
            
            html += '<div style="background:#f0fdf4;padding:1.5rem;border-radius:0.75rem;margin:1rem 0;"><h3>ğŸ‘¥ Ã‰lÃ¨ves - Passage ' + (state.passage + 1) + '</h3>' + renderStudentsList() + '</div>';
            
            html += '<div style="display:flex;justify-content:space-between;margin-top:2rem;">';
            if (state.passage > 0) {
                html += '<button class="btn btn-secondary" onclick="state.passage--;render()">â† PrÃ©cÃ©dent</button>';
            } else {
                html += '<div></div>';
            }
            if (state.passage < sit.passages.length - 1) {
                html += '<button class="btn" onclick="state.passage++;render()">Suivant â†’</button>';
            } else {
                html += '<button class="btn btn-success" onclick="state.view=\'situations\';render()">âœ“ Terminer</button>';
            }
            html += '</div>';
            
            document.getElementById('header-buttons').innerHTML = '<button class="btn btn-secondary" onclick="state.view=\'situations\';render()">â† Retour</button>';
            document.getElementById('main-content').innerHTML = html;
        }

        function renderStudentsList() {
            if (state.students.length === 0) {
                return '<p style="color:#6b7280">Aucun Ã©lÃ¨ve</p><button class="btn" onclick="state.view=\'students\';render()">Ajouter Ã©lÃ¨ves</button>';
            }
            let html = '';
            state.students.forEach(st => {
                const key = state.chapter + '-' + state.situation + '-p' + state.passage;
                const res = (state.results[key] && state.results[key][st.id]) || { s: 0, f: 0 };
                const tot = res.s + res.f;
                const pct = tot > 0 ? Math.round((res.s / tot) * 100) : 0;
                html += '<div class="student-card"><div style="font-weight:600">' + st.firstName + ' ' + st.lastName + '</div>' +
                    '<div style="display:flex;gap:0.5rem;align-items:center;margin-top:0.5rem;">' +
                    '<button class="counter-btn success" onclick="addSuccess(\''+st.id+'\')">+</button>' +
                    '<span>RÃ©ussi: <strong>' + res.s + '</strong></span>' +
                    '<button class="counter-btn danger" onclick="addFailure(\''+st.id+'\')">-</button>' +
                    '<span>Ã‰chec: <strong>' + res.f + '</strong></span>' +
                    '<button class="btn btn-secondary" style="padding:0.5rem 1rem;margin-left:auto" onclick="resetStudent(\''+st.id+'\')">â†º</button>' +
                    '</div><div style="margin-top:0.5rem;color:#6b7280;font-size:0.875rem">Total: ' + tot + ' essais | ' + pct + '% rÃ©ussite</div></div>';
            });
            return html;
        }

        function addSuccess(id) {
            const key = state.chapter + '-' + state.situation + '-p' + state.passage;
            if (!state.results[key]) state.results[key] = {};
            if (!state.results[key][id]) state.results[key][id] = { s: 0, f: 0 };
            state.results[key][id].s++;
            saveData();
            render();
        }

        function addFailure(id) {
            const key = state.chapter + '-' + state.situation + '-p' + state.passage;
            if (!state.results[key]) state.results[key] = {};
            if (!state.results[key][id]) state.results[key][id] = { s: 0, f: 0 };
            state.results[key][id].f++;
            saveData();
            render();
        }

        function resetStudent(id) {
            if (confirm('RÃ©initialiser ce passage ?')) {
                const key = state.chapter + '-' + state.situation + '-p' + state.passage;
                if (state.results[key] && state.results[key][id]) {
                    state.results[key][id] = { s: 0, f: 0 };
                    saveData();
                    render();
                }
            }
        }

        function renderStudents() {
            document.getElementById('header-buttons').innerHTML = '<button class="btn btn-secondary" onclick="state.view=\'home\';render()">â† Retour</button>';
            let html = '<h2>ğŸ‘¥ Gestion des Ã©lÃ¨ves</h2>' +
                '<div style="background:#eff6ff;padding:1.5rem;border-radius:0.75rem;margin:1rem 0;">' +
                '<h3>â• Ajouter un Ã©lÃ¨ve</h3>' +
                '<div style="display:flex;gap:0.5rem;flex-wrap:wrap;margin-top:1rem;">' +
                '<input type="text" id="firstName" placeholder="PrÃ©nom" style="padding:0.75rem;border:1px solid #d1d5db;border-radius:0.5rem;flex:1;min-width:150px">' +
                '<input type="text" id="lastName" placeholder="Nom" style="padding:0.75rem;border:1px solid #d1d5db;border-radius:0.5rem;flex:1;min-width:150px">' +
                '<button class="btn" onclick="addStudent()">Ajouter</button></div></div>';
            
            html += '<div style="background:#f9fafb;padding:1.5rem;border-radius:0.75rem"><h3>ğŸ“‹ Liste (' + state.students.length + ')</h3>';
            if (state.students.length === 0) {
                html += '<p style="color:#6b7280">Aucun Ã©lÃ¨ve</p>';
            } else {
                state.students.forEach(st => {
                    html += '<div style="display:flex;justify-content:space-between;align-items:center;padding:1rem;background:white;border-radius:0.5rem;margin:0.5rem 0">' +
                        '<div><strong>' + st.firstName + ' ' + st.lastName + '</strong></div>' +
                        '<button class="btn btn-danger" onclick="deleteStudent(\''+st.id+'\')">ğŸ—‘ï¸</button></div>';
                });
            }
            html += '</div>';
            
            if (state.students.length > 0) {
                html += '<div style="background:#fef2f2;border:2px solid #ef4444;padding:1.5rem;border-radius:0.75rem;margin-top:2rem">' +
                    '<h3 style="color:#dc2626">âš ï¸ Zone dangereuse</h3>' +
                    '<button class="btn btn-danger" onclick="deleteAll()">ğŸ—‘ï¸ Tout supprimer</button></div>';
            }
            
            document.getElementById('main-content').innerHTML = html;
        }

        function addStudent() {
            const fn = document.getElementById('firstName').value.trim();
            const ln = document.getElementById('lastName').value.trim();
            if (!fn || !ln) { alert('Remplissez prÃ©nom et nom'); return; }
            state.students.push({ id: Date.now().toString(), firstName: fn, lastName: ln });
            saveData();
            render();
        }

        function deleteStudent(id) {
            if (confirm('Supprimer cet Ã©lÃ¨ve ?')) {
                state.students = state.students.filter(s => s.id !== id);
                Object.keys(state.results).forEach(k => {
                    if (state.results[k][id]) delete state.results[k][id];
                });
                saveData();
                render();
            }
        }

        function deleteAll() {
            if (confirm('SUPPRIMER TOUT ?')) {
                state.students = [];
                state.results = {};
                saveData();
                render();
            }
        }

        function renderStats() {
            document.getElementById('header-buttons').innerHTML = '<button class="btn btn-secondary" onclick="state.view=\'home\';render()">â† Retour</button>';
            let html = '<h2>ğŸ“Š Statistiques</h2>';
            if (state.students.length === 0) {
                html += '<p style="color:#6b7280">Aucun Ã©lÃ¨ve</p>';
            } else {
                state.students.forEach(st => {
                    const stats = calcStats(st.id);
                    const badge = getBadge(stats.pct);
                    html += '<div style="background:#f9fafb;padding:1.5rem;border-radius:0.75rem;margin:1rem 0">' +
                        '<div style="display:flex;justify-content:space-between;align-items:center">' +
                        '<h3>' + st.firstName + ' ' + st.lastName + '</h3>' +
                        '<div><span style="font-size:1.5rem;font-weight:bold;color:#2563eb;margin-right:1rem">' + stats.pct + '%</span>' +
                        '<span class="badge ' + badge.cls + '">' + badge.txt + '</span></div></div>' +
                        '<p style="color:#6b7280;margin-top:0.5rem">' + stats.succ + ' rÃ©ussites / ' + stats.tot + ' essais</p></div>';
                });
            }
            document.getElementById('main-content').innerHTML = html;
        }

        function calcStats(id) {
            let succ = 0, tot = 0;
            Object.keys(state.results).forEach(k => {
                if (state.results[k][id]) {
                    succ += state.results[k][id].s;
                    tot += state.results[k][id].s + state.results[k][id].f;
                }
            });
            return { succ, tot, pct: tot > 0 ? Math.round((succ / tot) * 100) : 0 };
        }

        function getBadge(pct) {
            if (pct >= 86) return { txt: 'Excellent', cls: 'badge-excellent' };
            if (pct >= 66) return { txt: 'TrÃ¨s bien', cls: 'badge-tres-bien' };
            if (pct >= 50) return { txt: 'Bien', cls: 'badge-bien' };
            return { txt: 'Ã€ amÃ©liorer', cls: 'badge-bien' };
        }

        function renderWarmup() {
            const steps = state.level === 2 ? 
                ['Mobilisation', 'Ã‰chauffement gÃ©nÃ©ral', 'Zone avant', 'Zone centrale', 'Jeu court/long', 'Jeu diagonale'] :
                ['Mobilisation', 'L\'Horloge', 'Ã‰chauffement gÃ©nÃ©ral', 'Zone avant', 'Zone centrale', 'Jeu court/long', 'Jeu diagonale'];
            
            document.getElementById('header-buttons').innerHTML = '<button class="btn btn-secondary" onclick="state.view=\'home\';render()">â† Accueil</button>';
            
            let html = '<h2>ğŸ”¥ Ã‰chauffement - Ã‰tape ' + (state.warmupStep + 1) + '/' + steps.length + '</h2>';
            html += '<div class="progress-bar"><div class="progress-fill" style="width:' + ((state.warmupStep / steps.length) * 100) + '%"></div></div>';
            
            if (state.warmupStep === 0) {
                html += '<div style="background:#eff6ff;padding:1.5rem;border-radius:0.75rem;margin:1rem 0">' +
                    '<h3>âš™ï¸ Mobilisation articulaire</h3><p>4 minutes pour tout</p>' +
                    renderTimer(240) +
                    '<div class="articulation-grid">' +
                    '<div class="articulation-card"><div style="font-size:2rem">ğŸ’ª</div><div>Ã‰paules</div><div style="font-size:0.875rem">10 rotations</div></div>' +
                    '<div class="articulation-card"><div style="font-size:2rem">ğŸ’ª</div><div>Coudes</div><div style="font-size:0.875rem">10 rotations</div></div>' +
                    '<div class="articulation-card"><div style="font-size:2rem">âœ‹</div><div>Poignets</div><div style="font-size:0.875rem">10 rotations</div></div>' +
                    '<div class="articulation-card"><div style="font-size:2rem">ğŸ”„</div><div>Bassin</div><div style="font-size:0.875rem">10 rotations</div></div>' +
                    '<div class="articulation-card"><div style="font-size:2rem">ğŸ¦µ</div><div>Genoux</div><div style="font-size:0.875rem">10 rotations</div></div>' +
                    '<div class="articulation-card"><div style="font-size:2rem">ğŸ¦¶</div><div>Chevilles</div><div style="font-size:0.875rem">10 rotations</div></div>' +
                    '</div></div>';
            } else if (state.warmupStep === 1 && state.level !== 2) {
                html += '<div style="background:#eff6ff;padding:1.5rem;border-radius:0.75rem;margin:1rem 0">' +
                    '<h3>ğŸ• L\'Horloge</h3><p>3 minutes - DÃ©placements multidirectionnels</p>' +
                    '<p style="margin:1rem 0">CENTRE â†’ 1h (FENTE) â†’ CENTRE â†’ 2h (FENTE) â†’ ... â†’ 12h</p>' +
                    renderTimer(180) + '</div>';
            } else {
                const isRaquette = state.warmupStep >= (state.level === 2 ? 2 : 3);
                html += '<div style="background:#eff6ff;padding:1.5rem;border-radius:0.75rem;margin:1rem 0">' +
                    '<h3>' + steps[state.warmupStep] + '</h3>' +
                    (isRaquette ? '<p>ğŸ¸ 5 minutes - ğŸ”Š Bip toutes les 1min30</p>' + renderTimer(300, 90) : 
                                   '<p>3 minutes</p>' + renderTimer(180)) +
                    '</div>';
            }
            
            html += '<div style="display:flex;justify-content:space-between;margin-top:2rem;">';
            if (state.warmupStep > 0) {
                html += '<button class="btn btn-secondary" onclick="state.warmupStep--;render()">â† PrÃ©cÃ©dent</button>';
            } else {
                html += '<div></div>';
            }
            if (state.warmupStep < steps.length - 1) {
                html += '<button class="btn" onclick="state.warmupStep++;stopTimer();render()">Suivant â†’</button>';
            } else {
                html += '<button class="btn btn-success" onclick="state.view=\'home\';stopTimer();render()">âœ“ Terminer</button>';
            }
            html += '</div>';
            
            document.getElementById('main-content').innerHTML = html;
        }

        function renderTimer(dur, beep = null) {
            state.timerDuration = dur;
            state.timerBeep = beep;
            return '<div class="timer-display" id="timerDisplay">' + formatTime(dur) + '</div>' +
                '<div style="text-align:center">' +
                '<button class="btn btn-success" onclick="startTimer()">â–¶ï¸ DÃ©marrer</button>' +
                '<button class="btn btn-secondary" onclick="pauseTimer()">â¸ï¸ Pause</button>' +
                '<button class="btn btn-secondary" onclick="resetTimer()">â†º Reset</button></div>';
        }

        function startTimer() {
            if (state.timer) return;
            state.timerSec = state.timerSec || state.timerDuration;
            state.timer = setInterval(() => {
                state.timerSec--;
                const disp = document.getElementById('timerDisplay');
                if (disp) {
                    disp.textContent = formatTime(state.timerSec);
                    if (state.timerSec <= 10) disp.style.color = '#ef4444';
                }
                if (state.timerBeep && state.timerSec > 0 && (state.timerDuration - state.timerSec) % state.timerBeep === 0) {
                    beep();
                }
                if (state.timerSec <= 0) {
                    stopTimer();
                    beep(500);
                    if (disp) disp.textContent = '00:00';
                }
            }, 1000);
        }

        function pauseTimer() {
            if (state.timer) {
                clearInterval(state.timer);
                state.timer = null;
            }
        }

        function stopTimer() {
            pauseTimer();
            state.timerSec = 0;
        }

        function resetTimer() {
            stopTimer();
            state.timerSec = state.timerDuration;
            const disp = document.getElementById('timerDisplay');
            if (disp) {
                disp.textContent = formatTime(state.timerDuration);
                disp.style.color = '#2563eb';
            }
        }

        function formatTime(sec) {
            const m = Math.floor(sec / 60);
            const s = sec % 60;
            return (m < 10 ? '0' : '') + m + ':' + (s < 10 ? '0' : '') + s;
        }

        function beep(dur = 200) {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.value = 800;
            gain.gain.setValueAtTime(0.3, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + dur / 1000);
            osc.start();
            osc.stop(ctx.currentTime + dur / 1000);
        }

        function saveData() {
            localStorage.setItem('badminton-students', JSON.stringify(state.students));
            localStorage.setItem('badminton-results', JSON.stringify(state.results));
        }

        function loadData() {
            try {
                const st = localStorage.getItem('badminton-students');
                const res = localStorage.getItem('badminton-results');
                if (st) state.students = JSON.parse(st);
                if (res) state.results = JSON.parse(res);
            } catch (e) {}
        }

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js').catch(() => {});
        }

        loadData();
        render();
    </script>
</body>
</html>
